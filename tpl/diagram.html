<script src="js/outlierhints.js"></script>
<h1>[[diagram_view]]</h1>
<div id="navi_left">
	<div>
		<a href="#" class="active"><img src="img/diagram.png" width="50" height="50" alt="[[diagram_view]]" class="active"></a>
		<a href="index.php?s=table&amp;fid={feedId}&amp;timeframe={time}&amp;lang={language}"><img src="img/table.png" width="50" height="50" alt="[[table_view]]" class="last"></a>
	</div>
	<div>
		<img src="img/co.png" width="50" height="50" alt="[[co]]" id="sensor_co" class="active sensor" onClick="co();">
		<img src="img/no2.png" width="50" height="50" alt="[[no2]]" id="sensor_no2" class="sensor" onClick="no2();">
		<img src="img/temp.png" width="50" height="50" alt="[[temperature]]" id="sensor_temperature" class="sensor" onClick="temp();">
		<img src="img/hum.png" width="50" height="50" alt="[[humidity]]" id="sensor_humidity" class="last sensor" onClick="hum();">
	</div>
	<div>
		<a href="index.php?s=download&amp;fid={feedId}&amp;lang={language}"><img src="img/download.png" width="50" height="50" alt="[[data_download]]" class="last"></a>
	</div>
</div>
<div id="time_picker">
	<div{6h_active}><a href="index.php?s=diagram&amp;fid={feedId}&amp;timeframe=6h&amp;lang={language}">[[6_hours]]</a></div>
	<div{24h_active}><a href="index.php?s=diagram&amp;fid={feedId}&amp;timeframe=24h&amp;lang={language}">[[24_hours]]</a></div>
	<div{48h_active}><a href="index.php?s=diagram&amp;fid={feedId}&amp;timeframe=48h&amp;lang={language}">[[48_hours]]</a></div>
	<div{1w_active}><a href="index.php?s=diagram&amp;fid={feedId}&amp;timeframe=1w&amp;lang={language}">[[one_week]]</a></div>
	<div{1m_active}><a href="index.php?s=diagram&amp;fid={feedId}&amp;timeframe=1m&amp;lang={language}">[[one_month]]</a></div>
	<div{3m_active}><a href="index.php?s=diagram&amp;fid={feedId}&amp;timeframe=3m&amp;lang={language}">[[3_month]]</a></div>
</div>
<div id="data_content">
	<div{hidden}>
		<div class="details">
			<h4>[[description]]</h4>
			<p>{description}</p>
			<div class="left">
				<h4>[[pos_and_ele]]</h4>
				<table class="metadata">
					<tr>
						<td>[[location_name]]:</td>
						<td>{locationName}</td>
					</tr>
					<tr>
						<td>[[latitude]]:</td>
						<td>{lat}</td>
					</tr>
					<tr>
						<td>[[longitude]]:</td>
						<td>{lon}</td>
					</tr>
					<tr>
						<td>[[ele]]:</td>
						<td>{ele}</td>
					</tr>
				</table>
			</div>
			<h4>[[more_info]]</h4>
			<table class="metadata">
				<tr>
					<td>[[state]]:</td>
					<td>{status}</td>
				</tr>
				<tr>
					<td>[[feed_id]]:</td>
					<td><a href="https://cosm.com/feeds/{feedId}" target="_blank">{feedId}</a></td>
				</tr>
				<tr>
					<td>[[exposure]]:</td>
					<td>{exposure}</td>
				</tr>
			</table>
            <br>
		</div>
	</div><br>
    <div class="details">
        <h4>[[outlier_detection]]</h4>
        {outliers}
        <table class="outliers">
            <tr>
                <td colspan="2">{outlierState}</td>
            </tr>
            <tr>
                <td>[[sensitivity]]:</td>
                <td class="outlierselect">
                    <form action="index.php" method="get">
                        <input type="hidden" name="s" value="diagram">
                        <input type="hidden" name="fid" value="{feedId}">
                        <input type="hidden" name="timeframe" value="{time}">
                        <input type="hidden" name="interpolateoutliers" value="{interpolateOutliers}">
                        <select name="sensitivity" onChange="this.form.submit()">
                            <option value="0"{sensitivity_0_selected}>[[no_outlier_detection]]</option>
                            <option value="1"{sensitivity_1_selected}>[[low]]</option>
                            <option value="2"{sensitivity_2_selected}>[[medium]]</option>
                            <option value="3"{sensitivity_3_selected}>[[high]]</option>
                        </select>
                        <input type="hidden" name="lang" value="{language}">
                    </form>
                </td>
            </tr>
        </table>
    </div><br>
	<script src='https://www.google.com/jsapi'></script>
	<script>
	    // Load the Visualization API and the piechart package.
	    google.load('visualization', '1.0', {'packages':['corechart']});

	    // Set a callback to run when the Google Visualization API is loaded.
	    google.setOnLoadCallback(drawChart);

	    var columns = [0,1,2];
		
	    var options = {
	        height: 400,
	        colors: ['#000000'],
	        legend: {position: 'none'},
	        backgroundColor: '#E9F2F9',
	        chartArea:{top: 40, width:'85%', height: '70%'},
	        vAxis: {title: '[[co]] (ppm)'},
	        hAxis: {title: '[[date_time]]', format: 'dd.MM.y H:mm'},
	        tooltip: {isHtml: true},
	        interpolateNulls: true
	    };
		
	    // Callback that creates and populates a data table, 
	    // instantiates the pie chart, passes in the data and
	    // draws it.
	    function drawChart() {		
	        var dataTable = new google.visualization.DataTable();
	        dataTable.addColumn('datetime', 'Date / Time');
	        dataTable.addColumn('number', 'CO');
	        dataTable.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
	        dataTable.addColumn('number', 'NO2');
	        dataTable.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
	        dataTable.addColumn('number', 'Temperature');
	        dataTable.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
	        dataTable.addColumn('number', 'Humidity');
	        dataTable.addColumn({type: 'string', role: 'tooltip', 'p': {'html': true}});
	        dataTable.addColumn('number', 'timestamp');
			
	        dataTable.addRows([
				{+diagramData}
				[new Date({t}),
				{no2}, '<div class="tooltip"><b>{lt}</b><br>[[no2]]: {no2} ppm</div>',
				{co}, '<div class="tooltip"><b>{lt}</b><br>[[co]]: {co} ppm</div>',
				{temp}, '<div class="tooltip"><b>{lt}</b><br>[[temperature]]: {temp} &deg;C</div>',
				{hum}, '<div class="tooltip"><b>{lt}</b><br>[[humidity]]: {hum} %</div>',
				{timestamp}]{,}
	            {-diagramData}
	        ]);
			
	        var view = new google.visualization.DataView(dataTable);
	        view.setColumns(columns);

	        var chart = new google.visualization.LineChart(document.getElementById('diagram'));
			 
	        chart.draw(view, options);
	    }
		
	    window.onresize = function(event) {
	        drawChart();
	    }
		
	    function co() {
	        columns = [0,1,2];
	        options['vAxis'] = {title: '[[co]] (ppm)'};
	        options['colors'] = ['#000000'];

	        document.getElementById('sensor_co').style.borderRight = '10px solid #BCD7ED';
	        document.getElementById('sensor_no2').style.borderRight = 'none';
	        document.getElementById('sensor_temperature').style.borderRight = 'none';
	        document.getElementById('sensor_humidity').style.borderRight = 'none';
			
	        drawChart();
	    }
		
	    function no2() {
	        columns = [0,3,4];
	        options['vAxis'] = {title: '[[no_2]] (ppm)'};
	        options['colors'] = ['#A04801'];
			
	        document.getElementById('sensor_co').style.borderRight = 'none';
	        document.getElementById('sensor_no2').style.borderRight = '10px solid #BCD7ED';
	        document.getElementById('sensor_temperature').style.borderRight = 'none';
	        document.getElementById('sensor_humidity').style.borderRight = 'none';

	        drawChart();
	    }
		
	    function temp() {
	        columns = [0,5,6];
	        options['vAxis'] = {title: '[[temperature]] ([[degrees_celsius]])'};
	        options['colors'] = ['#D62A1E'];
			
	        document.getElementById('sensor_co').style.borderRight = 'none';
	        document.getElementById('sensor_no2').style.borderRight = 'none';
	        document.getElementById('sensor_temperature').style.borderRight = '10px solid #BCD7ED';
	        document.getElementById('sensor_humidity').style.borderRight = 'none';
			
	        drawChart();
	    }
		
	    function hum() {
	        columns = [0,7,8];
	        options['vAxis'] = {title: '[[humidity]] (%)'};
	        options['colors'] = ['#7AA1EB'];
			
	        document.getElementById('sensor_co').style.borderRight = 'none';
	        document.getElementById('sensor_no2').style.borderRight = 'none';
	        document.getElementById('sensor_temperature').style.borderRight = 'none';
	        document.getElementById('sensor_humidity').style.borderRight = '10px solid #BCD7ED';
			
	        drawChart();
	    }
	</script>
    <div class="details">
        <div id="diagram"></div>
    </div><br>
    {errormessage}
</div>